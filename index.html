<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel File Viewer and Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@11.1.0/dist/handsontable.full.min.css">
    <script src="https://cdn.jsdelivr.net/npm/handsontable@11.1.0/dist/handsontable.full.min.js"></script>
    <style>
        .sheet {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #000;
        }
        button {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

<h2>Excel File Viewer and Editor</h2>
<div id="sheetsContainer"></div>

<!-- Buttons -->
<button id="downloadBtn">Download Edited Excel File</button>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const excelFileUrl = 'https://raw.githubusercontent.com/ARPROGAM/Davomatt/89f4349f596c0136125544ee9937538b278c5609/BIQ%20213-21%20guruh%20davomat.xlsx';

        // Fetch the Excel file from GitHub
        fetch(excelFileUrl)
        .then(response => response.arrayBuffer())
        .then(data => {
            const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
            const sheetsContainer = document.getElementById('sheetsContainer');

            // Initialize an empty object to store handsontable instances for each sheet
            const hotInstances = {};

            // Loop through each sheet in the workbook and display them as Handsontable
            workbook.SheetNames.forEach(function(sheetName) {
                const sheet = workbook.Sheets[sheetName];
                const sheetData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // Create a div for each sheet
                const sheetDiv = document.createElement('div');
                sheetDiv.classList.add('sheet');
                sheetDiv.innerHTML = `<h3>${sheetName}</h3>`;
                const tableDiv = document.createElement('div');
                sheetDiv.appendChild(tableDiv);
                sheetsContainer.appendChild(sheetDiv);

                // Initialize Handsontable
                const hot = new Handsontable(tableDiv, {
                    data: sheetData,
                    rowHeaders: true,
                    colHeaders: true,
                    contextMenu: true,
                    stretchH: 'all',  // Make it responsive to fill the width
                    licenseKey: 'non-commercial-and-evaluation',
                    minSpareRows: 1,  // Allow new row to be added
                });

                // Store the Handsontable instance in the hotInstances object
                hotInstances[sheetName] = hot;
            });

            // Download the edited Excel file
            document.getElementById('downloadBtn').addEventListener('click', function() {
                // Create a new workbook
                const newWorkbook = XLSX.utils.book_new();

                // Loop through each Handsontable instance and convert to sheet
                Object.keys(hotInstances).forEach(function(sheetName) {
                    const hot = hotInstances[sheetName];
                    const editedData = hot.getData();
                    const newSheet = XLSX.utils.aoa_to_sheet(editedData);
                    XLSX.utils.book_append_sheet(newWorkbook, newSheet, sheetName);
                });

                // Download the new workbook as an Excel file
                XLSX.writeFile(newWorkbook, 'edited_excel_file.xlsx');
            });

        })
        .catch(error => console.error('Error fetching the Excel file:', error));
    });
</script>

</body>
</html>
